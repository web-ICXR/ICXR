(function($,window,undefined){var v_u_domain='https://online.ccf.org.cn/ccfonline/';var suffix='.action';var url_vist_record=v_u_domain+"visit/save"+suffix;var url_vist_update_previous=v_u_domain+"visit/update"+suffix;var self_name='visit.v2.js';$.support.cors=true;var returnCitySN=isNotEmpty(window.returnCitySN)?window.returnCitySN:{};var ip_addr=returnCitySN["cip"];var visit_id=generateID();var VISIT_UNIQUE_COOKIE_ID="VISIT_U_ID";var SESSION_ID="JSESSIONID";var LOCAL_PREVIOUS_1="visit_local_previous1";var LOCAL_PREVIOUS_2="visit_local_previous2";var LOCAL_INDEX="visit_local_index";var cookieUtil=(function($){var cookieUtil={};var pluses=/\+/g;function encode(s){return config.raw?s:encodeURIComponent(s);}function decode(s){return config.raw?s:decodeURIComponent(s);}function stringifyCookieValue(value){return encode(config.json?JSON.stringify(value):String(value));}function parseCookieValue(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');}try{s=decodeURIComponent(s.replace(pluses,' '));return config.json?JSON.parse(s):s;}catch(e){}}function read(s,converter){var value=config.raw?s:parseCookieValue(s);return $.isFunction(converter)?converter(value):value;}var config=cookieUtil.cookie=function(key,value,options){if(arguments.length>1&&!$.isFunction(value)){options=$.extend({},config.defaults,options);if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setMilliseconds(t.getMilliseconds()+days*864e+5);}return(document.cookie=[encode(key),'=',stringifyCookieValue(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}var result=key?undefined:{},cookies=document.cookie?document.cookie.split('; '):[],i=0,l=cookies.length;for(;i<l;i++){var parts=cookies[i].split('='),name=decode(parts.shift()),cookie=parts.join('=');if(key===name){result=read(cookie,value);break;}if(!key&&(cookie=read(cookie))!==undefined){result[name]=cookie;}}return result;};config.defaults={};cookieUtil.removeCookie=function(key,options){cookieUtil.cookie(key,'',$.extend({},options,{expires:-1}));return!cookieUtil.cookie(key);};cookieUtil.setItem=function(key,val){return cookieUtil.cookie(key,val,{path:'/',expires:7});};cookieUtil.getItem=function(key){return cookieUtil.cookie(key);};return cookieUtil;})($);var baseParams={id:visit_id,visit_url:window.document.location.href,cookie_id:getCookieid(),session_id:getJSESSIONID(),action_type:"",page_type:"",user_id:"",referrer:getReferrer(),country:"",province:"",city:"",ip:ip_addr,os:getOs(),browser:getBrowser(),browser_version:getBrowserVersion(),device:getDevice(),has_scroll:false,visit_time:fmtData(new Date(),'yyyy-MM-dd hh:mm:ss'),leave_time:"",if_fromrec:'0',html:""};var nextParams={id:visit_id,user_id:getParamsVal('user_id'),has_scroll:false,leave_time:""};baseParams.action_type=getParamsVal('action_type');baseParams.page_type=getParamsVal('page_type');baseParams.user_id=getParamsVal('user_id');nextParams.user_id=baseParams.user_id;function getParamsVal(field){if(isNotEmpty(baseParams[field])){return baseParams[field];}var u=getParams(self_name,field);if(isEmpty(u)&&window.PAGE_VISIR_INFO){u=window.PAGE_VISIR_INFO[field];}if(isEmpty(u)){var $ele=$("#page_visit_"+field);u=$ele.length>0?$ele.val():'';}return isNotEmpty(u)?u:'';}baseParams.html=window.document.documentElement.outerHTML;var storage=(function($,window,undefined){var storage={};var localStore=getLocalStorage();function getLocalStorage(){if(typeof localStorage=="object"){return localStorage;}else if(typeof globalStorage=="object"){return globalStorage[location.host];}else{return cookieUtil;}};storage.writeLocal=function(key,val){if(isEmpty(key)||isEmpty(val)){return;}localStore.setItem(key,val);};storage.readLocal=function(key){if(isEmpty(key)){return"";}return localStore.getItem(key);};storage.removeLocal=function(key){try{localStore.removeItem(key);}catch(e){localStore.setItem(key,'');}};storage.writeJson=function(key,json){storage.writeLocal(key,JSON.stringify(json));};storage.readJson=function(key){var strJson=storage.readLocal(key);return JSON.parse(strJson);};storage.updateJson=function(key,json){if(isEmpty(json)){return;}var oldJson=storage.readJson(key);$.extend(oldJson||{},json);storage.writeJson(key,oldJson);};return storage;})($,window);var LOCAL_PREVIOUS_KEY="";var LOCAL_CURRENT_KEY="";(function(){var index=storage.readLocal(LOCAL_INDEX);if(index=='1'){LOCAL_PREVIOUS_KEY=LOCAL_PREVIOUS_1;LOCAL_CURRENT_KEY=LOCAL_PREVIOUS_2;storage.writeLocal(LOCAL_INDEX,'2');}else{LOCAL_PREVIOUS_KEY=LOCAL_PREVIOUS_2;LOCAL_CURRENT_KEY=LOCAL_PREVIOUS_1;storage.writeLocal(LOCAL_INDEX,'1');}})();$(window).scroll(function(){baseParams.has_scroll=true;nextParams.has_scroll=true;});var VIST_ROOT_CCF={};VIST_ROOT_CCF.display=function(){return baseParams;};VIST_ROOT_CCF.report=function(){var params=VIST_ROOT_CCF.display();record(params);};VIST_ROOT_CCF.reportNow=function(){try{reportPrevious();}catch(e){}try{VIST_ROOT_CCF.report();}catch(e){}upLeaveTime();};window.onbeforeunload=function(){var leave_time_str=fmtData(new Date(),"yyyy-MM-dd hh:mm:ss");baseParams.leave_time=leave_time_str;nextParams.leave_time=leave_time_str;if(isEmpty(baseParams.user_id)||isEmpty(nextParams.user_id)){var userId=getParamsVal('user_id');baseParams.user_id=userId;nextParams.user_id=userId;}reportPreviousPost(nextParams);};function upLeaveTime(){storage.writeJson(LOCAL_CURRENT_KEY,nextParams);setInterval(function(){nextParams.leave_time=fmtData(new Date(),'yyyy-MM-dd hh:mm:ss');if(isEmpty(nextParams.user_id)){nextParams.user_id=getParamsVal('user_id');}storage.updateJson(LOCAL_CURRENT_KEY,nextParams);},1000);};function reportPrevious(){var params=storage.readJson(LOCAL_PREVIOUS_KEY);if(isEmpty(params)){storage.writeJson(LOCAL_CURRENT_KEY,nextParams);return;}$.post(url_vist_update_previous,params).done(function(data){if(isSuccess(data)){storage.removeLocal(LOCAL_CURRENT_KEY);}}).fail(function(jqXHR,textStatus,errorThrown){console.log(jqXHR);console.log(textStatus);console.log(errorThrown);});};function reportPreviousPost(params){$.post(url_vist_update_previous,params).done(function(data){if(isSuccess(data)){storage.removeLocal(LOCAL_PREVIOUS_KEY);}else{$.post(url_vist_update_previous,params).done(function(data){if(isSuccess(data)){storage.removeLocal(LOCAL_PREVIOUS_KEY);}}).fail(function(jqXHR,textStatus,errorThrown){});}}).fail(function(jqXHR,textStatus,errorThrown){console.log(jqXHR);console.log(textStatus);console.log(errorThrown);});};function record(params){$.post(url_vist_record,params).done(function(data){}).fail(function(jqXHR,textStatus,errorThrown){console.log(jqXHR);console.log(textStatus);console.log(errorThrown);});};function getCountry(){var language=navigator.browserLanguage?navigator.browserLanguage:navigator.language;return language;};function getDomain(){var strFullPath=window.document.location.href;var strPath=window.document.location.pathname;var pos=strFullPath.indexOf(strPath);var prePath=strFullPath.substring(0,pos);var postPath=strPath.substring(0,strPath.substr(1).indexOf('/')+1);var webPath=prePath+postPath;return webPath;};function getDomainName(serverName){var domainName=null;if(isEmpty(serverName)){domainName="";}else{serverName=serverName.toLowerCase();serverName=serverName.substring(7);var end=serverName.indexOf("/");serverName=serverName.substring(0,end);var REGEX_IP=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;if(REGEX_IP.test(serverName)){domainName=serverName;}else{var domains=serverName.split(".");var len=domains.length;if(len>3){domainName="."+domains[len-3]+"."+domains[len-2]+"."+domains[len-1];}else if(len<=3&&len>1){domainName="."+domains[len-2]+"."+domains[len-1];}else{domainName=serverName;}}}if(isNotEmpty(domainName)&&domainName.indexOf(":")>0){var ary=domainName.split("\\:");domainName=ary[0];}return domainName;};function isEmpty(val){if(typeof val==="undefined"||val===null||typeof val==="null"||val===''||val.length===0){return true;}else{return false;}};function isNotEmpty(val){return!isEmpty(val);};function getParams(jsname,param){var jspath=getJsPath(jsname);if(isEmpty(jspath)){return"";}var paramVal=getParamByJspath(jspath,param);return isNotEmpty(paramVal)?paramVal:"";};function getJsPath(jsname){var js=document.scripts;var jsPath="";for(var i=js.length;i>0;i--){if(js[i-1].src.indexOf(jsname)>-1){return js[i-1].src;}}return jsPath;};function getParamByJspath(jspath,parm){var urlparse=jspath.split("\?");var parms=urlparse[1].split("&");var values={};for(var i=0;i<parms.length;i++){var pr=parms[i].split("=");if(pr[0]==parm)return pr[1];}return"";};function generateID(){var currentDate=new Date();var pre_time=fmtData(currentDate,'yyyyMMddhhmmssSSS');var d=currentDate.getTime();var uuid=pre_time+guid(d);var len=64-uuid.length;for(var i=0;i<len;i++){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);uuid+=(r&0x3|0x8).toString(16);}return uuid;};function guid(roud){var r="";var v="";var hasIp=false;if(isNotEmpty(ip_addr)){hasIp=true;var ipArry=ip_addr.replace(/[.]/g,"").split("");}return'x0xx2xx4x5xx6x7xx9xcx10xxy11xxxx3xxx1xxxx8xxxx'.replace(/[xy]|[0-9]{1,2}/g,function(c){if(c=='x'){r=(roud+Math.random()*16)%16|0;v=r;}else if(c=='y'){r=(roud+Math.random()*16)%16|0;v=(r&0x3|0x8);}else{if(hasIp){v=ipArry[c];}else{v=Math.floor(Math.random()*10);}}return v.toString(16);});};function getReferrer(){var referrer='';try{referrer=window.top.document.referrer;}catch(e){if(window.parent){try{referrer=window.parent.document.referrer;}catch(e2){referrer='';}}}if(isEmpty(referrer)){referrer=window.document.referrer;}return referrer;};function getBrowser(){var ua=navigator.userAgent.toLowerCase();var browser="";if(/msie/i.test(ua)&&!/opera/.test(ua)){browser="IE";}else if(Object.hasOwnProperty.call(window,"ActiveXObject")&&!window.ActiveXObject){browser="IE";}else if(/firefox/i.test(ua)){browser="Firefox";}else if(/chrome/i.test(ua)&&/webkit/i.test(ua)&&/mozilla/i.test(ua)){browser="Chrome";}else if(/opera/i.test(ua)){browser="Opera";}else if(/webkit/i.test(ua)&&!(/chrome/i.test(ua)&&/webkit/i.test(ua)&&/mozilla/i.test(ua))){browser="Safari";}else if(/MicroMessenger/i.test(ua)){browser="微信";}else{browser="other";}return browser;};function getBrowserVersion(){var ua=navigator.userAgent.toLowerCase();var version=(ua.match(/.+(?:rv|it|chrome|pera|mqqbrowser|micromessengerra|ie)[\/: ]([\d.]+)/)||[0,'0'])[1];return version;};function getOs(){var sUserAgent=navigator.userAgent;var isWin=(navigator.platform.match(/Win32/i))||(navigator.platform.match(/Windows/i));if(isWin){var isWin2K=sUserAgent.indexOf("Windows NT 5.0")>-1||sUserAgent.indexOf("Windows 2000")>-1;if(isWin2K)return"Win2000";var isWinXP=sUserAgent.indexOf("Windows NT 5.1")>-1||sUserAgent.indexOf("Windows XP")>-1;if(isWinXP)return"WinXP";var isWin2003=sUserAgent.indexOf("Windows NT 5.2")>-1||sUserAgent.indexOf("Windows 2003")>-1;if(isWin2003)return"Win2003";var isWinVista=sUserAgent.indexOf("Windows NT 6.0")>-1||sUserAgent.indexOf("Windows Vista")>-1;if(isWinVista)return"WinVista";var isWin7=sUserAgent.indexOf("Windows NT 6.1")>-1||sUserAgent.indexOf("Windows 7")>-1;if(isWin7)return"Win7";var isWin8=sUserAgent.indexOf("Windows NT 6.2")>-1||sUserAgent.indexOf("Windows 8")>-1;if(isWin8)return"Win8";var isWin8_1=sUserAgent.indexOf("Windows NT 6.3")>-1||sUserAgent.indexOf("Windows 8")>-1;if(isWin8_1)return"Win8";var isWin10=sUserAgent.indexOf("Windows NT 10")>-1||sUserAgent.indexOf("Windows 10")>-1;if(isWin10)return"Win10";}var isMac=(navigator.platform=="Mac68K")||(navigator.platform=="MacPPC")||(navigator.platform=="Macintosh")||(navigator.platform=="MacIntel");if(isMac)return"Mac";var isUnix=(navigator.platform=="X11")&&!isWin&&!isMac;if(isUnix)return"Unix";var isLinux=(String(navigator.platform).match(/Linux/i));if(isLinux){if(sUserAgent.match(/Android/i)){return'Android';}return"Linux";}var ios=sUserAgent.indexOf("iPhone")>-1;if(ios)return"ios";return"pc";};function getDevice(){var sUserAgent=navigator.userAgent.toLowerCase();if(sUserAgent.match(/ipad/i)=="ipad"){return"ipad";}else if(sUserAgent.match(/iphone os/i)=="iphone os"){return"iphone";}else if(sUserAgent.match(/midp/i)=="midp"){return"midp";}else if(sUserAgent.match(/rv:1.2.3.4/i)=="rv:1.2.3.4"){return"uc7";}else if(sUserAgent.match(/ucweb/i)=="ucweb"){return"uc";}else if(sUserAgent.match(/android/i)=="android"){return"android";}else if(sUserAgent.match(/windows ce/i)=="windows ce"){return"windows ce";}else if(sUserAgent.match(/windows mobile/i)=="windows mobile"){return"windows mobile";}else if(sUserAgent.match(/mac os/i)=="mac os"){return"mac";}else if(sUserAgent.match(/SymbianOS/i)=="symbianos"){return"SymbianOS";}else{return"other";}};function getCookieid(){var cookieId=cookieUtil.cookie(VISIT_UNIQUE_COOKIE_ID);if(isNotEmpty(cookieId)){return cookieId;}var cookieVal=guid(new Date().getTime());var domain=getDomainName(getDomain());cookieUtil.cookie(VISIT_UNIQUE_COOKIE_ID,cookieVal,{domain:domain,path:'/',expires:365});return cookieVal;};function getJSESSIONID(){var cookieId=cookieUtil.cookie(SESSION_ID);return isNotEmpty(cookieId)?cookieId:"";};function fmtData(date,format){var o={"M+":date.getMonth()+1,"d+":date.getDate(),"h+":date.getHours(),"m+":date.getMinutes(),"s+":date.getSeconds(),"q+":Math.floor((date.getMonth()+3)/3)};if(/(y+)/.test(format)){format=format.replace(RegExp.$1,(date.getFullYear()+"").substr(4-RegExp.$1.length));};if(/(S+)/.test(format)){var ms=date.getMilliseconds().toString();format=format.replace(RegExp.$1,RegExp.$1.length==1?ms:("000".substr(0,3-ms.length)+ms));};for(var k in o){if(new RegExp("("+k+")").test(format)){format=format.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length));}};return format;};function isSuccess(data){if(data.code==1){return true;}else{return false;}};window['VIST_ROOT_CCF']=VIST_ROOT_CCF;})(jQuery,window);$(function(){VIST_ROOT_CCF.reportNow();});